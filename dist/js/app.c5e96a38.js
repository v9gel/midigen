(function(e){function t(t){for(var n,l,u=t[0],i=t[1],s=t[2],p=0,m=[];p<u.length;p++)l=u[p],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&m.push(o[l][0]),o[l]=0;for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n]);c&&c(t);while(m.length)m.shift()();return a.push.apply(a,s||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,u=1;u<r.length;u++){var i=r[u];0!==o[i]&&(n=!1)}n&&(a.splice(t--,1),e=l(l.s=r[0]))}return e}var n={},o={app:0},a=[];function l(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=n,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)l.d(r,n,function(t){return e[t]}.bind(null,n));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var u=window["webpackJsonp"]=window["webpackJsonp"]||[],i=u.push.bind(u);u.push=t,u=u.slice();for(var s=0;s<u.length;s++)t(u[s]);var c=i;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var n=r("85ec"),o=r.n(n);o.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("GeneratorMidi")],1)},a=[],l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[r("el-form-item",{attrs:{label:"Входной ритм",prop:"beat"}},[r("el-input",{attrs:{type:"textarea",disabled:e.ruleForm.isRandomBeat},model:{value:e.ruleForm.beat,callback:function(t){e.$set(e.ruleForm,"beat",t)},expression:"ruleForm.beat"}}),r("el-button",{staticStyle:{"margin-top":"25px"},attrs:{type:"default",disabled:e.ruleForm.isRandomBeat},on:{click:function(t){return e.randomBeat()}}},[e._v("Сгенерировать рандомный ритм")])],1),r("el-form-item",{attrs:{label:"Рандомный ритм для фрагментов",prop:"repeatControl"}},[r("el-switch",{model:{value:e.ruleForm.isRandomBeat,callback:function(t){e.$set(e.ruleForm,"isRandomBeat",t)},expression:"ruleForm.isRandomBeat"}})],1),r("el-form-item",{attrs:{label:"Один бит на файл",prop:"oneBeatFile"}},[r("el-switch",{model:{value:e.ruleForm.oneBeatFile,callback:function(t){e.$set(e.ruleForm,"oneBeatFile",t)},expression:"ruleForm.oneBeatFile"}})],1),r("el-form-item",{attrs:{label:"Диапазон нот",prop:"noteCount"}},[r("el-input-number",{attrs:{min:2,max:14},model:{value:e.ruleForm.noteCount,callback:function(t){e.$set(e.ruleForm,"noteCount",t)},expression:"ruleForm.noteCount"}})],1),r("el-form-item",{attrs:{label:"Длинна ритма",prop:"beatLength"}},[r("el-input-number",{attrs:{min:1,max:128},model:{value:e.ruleForm.beatLength,callback:function(t){e.$set(e.ruleForm,"beatLength",t)},expression:"ruleForm.beatLength"}}),e._v(" / 32 такта ")],1),r("el-form-item",{attrs:{label:"Предотвращать повторы",prop:"repeatControl"}},[r("el-switch",{model:{value:e.ruleForm.repeatControl,callback:function(t){e.$set(e.ruleForm,"repeatControl",t)},expression:"ruleForm.repeatControl"}})],1),r("el-form-item",{attrs:{label:"Короткие ноты",prop:"shortNote"}},[r("el-switch",{model:{value:e.ruleForm.shortNote,callback:function(t){e.$set(e.ruleForm,"shortNote",t)},expression:"ruleForm.shortNote"}})],1),r("el-form-item",{attrs:{label:"Пауза после ритма",prop:"restEnable"}},[r("el-switch",{model:{value:e.ruleForm.restEnable,callback:function(t){e.$set(e.ruleForm,"restEnable",t)},expression:"ruleForm.restEnable"}})],1),r("el-form-item",{attrs:{label:"Длина трека",prop:"trackLength"}},[r("el-input-number",{attrs:{min:1,max:1e4},model:{value:e.ruleForm.trackLength,callback:function(t){e.$set(e.ruleForm,"trackLength",t)},expression:"ruleForm.trackLength"}}),r("el-select",{staticStyle:{"margin-left":"20px"},attrs:{placeholder:"Select"},model:{value:e.ruleForm.typeLength,callback:function(t){e.$set(e.ruleForm,"typeLength",t)},expression:"ruleForm.typeLength"}},e._l(e.options,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"Количество файлов",prop:"filesCount"}},[r("el-input-number",{attrs:{min:1,max:50},model:{value:e.ruleForm.filesCount,callback:function(t){e.$set(e.ruleForm,"filesCount",t)},expression:"ruleForm.filesCount"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("Сгенерировать")]),r("el-button",{attrs:{type:"default"},on:{click:function(t){return e.saveConfig("ruleForm")}}},[e._v("Запомнить конфиг")])],1)],1),r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[r("el-form-item",{attrs:{label:"Скорость воспроизведения"}},[r("el-input-number",{attrs:{min:1,max:1024},on:{change:e.changeSpeed},model:{value:e.ruleForm.speed,callback:function(t){e.$set(e.ruleForm,"speed",t)},expression:"ruleForm.speed"}})],1)],1),e._l(e.tracks,(function(t,n){return r("ul",{key:n},[r("Track",{attrs:{track:t,speed:e.ruleForm.speed}})],1)}))],2)},u=[],i=(r("4de4"),r("4160"),r("a9e3"),r("9129"),r("ac1f"),r("1276"),r("159b"),r("1f78")),s=-10;function c(e,t,r){var n=e-.5+Math.random()*(t-e+1),o=Math.round(n);return r?o===s?c(e,t,r):(s=o,o):o}function p(e){function t(e,t){var r=e-.5+Math.random()*(t-e+1);return Math.round(r)}e*=4;var r=[2,4,8],n=0,o=[];while(n<=e-8){var a=r[t(0,2)];o.push(a),n+=a}return n===e-6?(o.push(2),o.push(4),n+=6):n===e-4?(o.push(4),n+=4):n===e-2&&(o.push(2),n+=2),o}var m=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"];function f(e,t){var r=e.beat,n=e.noteCount,o=e.repeatControl,a=e.trackLength,l=e.typeLength,u=e.restEnable,s=e.isRandomBeat,f=e.shortNote,d=e.beatLength,b=e.oneBeatFile,h=new i.Track,v=[];"sec"===l&&(a*=32);var g=0;r=p(d);for(var F=function(e){s&&!b&&(r=p(d)),r.forEach((function(t){e<a&&(v.push(new i.NoteEvent({pitch:[m[c(0,n-1,o)]],duration:!0===f?"T4":"T"+8*t,startTick:g})),g+=8*t),"note"===l?e++:"sec"===l&&(e+=t)})),"beat"===l&&e++,"sec"===l&&u&&(e+=16),u&&(g+=128),y=e},y=0;y<a;)F(y);h.setTempo(30).addEvent(v,(function(e,t){return{sequential:!0}}));var k=new i.Writer(h);return t?k.buildFile():k.dataUri()}var d=f,b=r("ec26"),h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{on:{allStop:e.stop}},[e._v(" "+e._s(e.name)+" "),r("el-button-group",[e.playing?e._e():r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.play}},[e._v("play")]),e.playing?r("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.stop}},[e._v("stop")]):e._e(),r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-download"},on:{click:e.download}})],1)],1)},v=[],g=(r("b0c0"),r("96cf"),r("1da1")),F=r("3f0e"),y=r.n(F),k=r("405e"),$=r.n(k),w=r("9e7e"),x={name:"Track",data:function(){return{playing:!1,name:this.name="track"+Object(b["a"])()+".mid"}},props:["track","speed"],methods:{play:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$root.$emit("all stop"),e.playing=!0,r=window.AudioContext||window.webkitAudioContext||!1,n=new r,o=e,t.next=7,setTimeout((function(){$.a.instrument(n,"https://raw.githubusercontent.com/gleitz/midi-js-soundfonts/gh-pages/MusyngKite/acoustic_grand_piano-mp3.js").then((function(e){var t=new y.a.Player((function(r){o.playing||t.stop(),"Note on"===r.name&&r.velocity>0&&(e.play(r.noteName,n.currentTime,{gain:r.velocity/100,duration:1}),console.log(r))}));t.loadDataUri(o.track),t.play(),t.setTempo(o.speed),o.$root.$on("all stop",(function(){t.stop()})),t.on("endOfFile",(function(){o.stop()}))}))}),1e3);case 7:case"end":return t.stop()}}),t)})))()},stop:function(){this.playing=!1},download:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Object(w["save"])(e.track,e.name);case 2:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this,t=this;this.$root.$on("all stop",(function(){t.stop()})),t.$root.$on("name generate",(function(){e.name="track"+Object(b["a"])()+".mid"}))},updated:function(){},destroyed:function(){this.stop()}},_=x,C=r("2877"),O=Object(C["a"])(_,h,v,!1,null,"ea9ff0ac",null),j=O.exports;var S={name:"GeneratorMidi",components:{Track:j},computed:{speed:function(){return this.store.speed}},data:function(){return{ruleForm:{beat:"2 4 8",noteCount:14,repeatControl:!0,restEnable:!0,beatLength:32,shortNote:!0,trackLength:5,typeLength:"note",isRandomBeat:!1,filesCount:2,speed:30,oneBeatFile:!1},tracks:[],rules:{beat:[{required:!0,pattern:/^( *[0-9]* *)*$/g,message:"Ритм должен содержать только числа, разделенные пробелом в одну строку",trigger:"blur"}]},options:[{value:"sec",label:"Секунд"},{value:"note",label:"Нот"},{value:"beat",label:"Ритмов"}]}},methods:{changeSpeed:function(e){this.$root.$emit("all stop"),this.$store.commit("changeSpeed",e)},randomBeat:function(){function e(e,t){var r=e-.5+Math.random()*(t-e+1);return Math.round(r)}var t=[2,4,8],r=0;this.ruleForm.beat="";while(r<64){var n=t[e(0,2)];if(this.ruleForm.beat=this.ruleForm.beat+n+" ",r+=n,e(0,20)<10&&r>16)break}},saveConfig:function(e){var t=this;console.log(1),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$root.$localStorage.set("config",t.ruleForm)}))},submitForm:function(e){var t=this;this.$root.$emit("all stop"),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var r=[];t.ruleForm.beat.split(" ").forEach((function(e){r.push(parseInt(e))}));var n=Object.assign({},t.ruleForm);if(n.beat=r.filter((function(e){return!Number.isNaN(e)})),1===n.filesCount){var o=d(n,!1);t.tracks=[o]}else{t.tracks=[];for(var a=0;a<n.filesCount;a++){var l=d(n,!1);t.tracks.push(l)}}t.$root.$emit("name generate",(function(){}))}))},resetForm:function(e){this.$refs[e].resetFields()}},mounted:function(){console.log(this.$root.$localStorage.get("config")),null!==this.$root.$localStorage.get("config")&&(this.ruleForm=this.$root.$localStorage.get("config"))}},B=S,L=Object(C["a"])(B,l,u,!1,null,"0347a9fa",null),E=L.exports,M={name:"App",components:{GeneratorMidi:E}},T=M,N=(r("034f"),Object(C["a"])(T,o,a,!1,null,null,null)),R=N.exports,P=r("5c96"),A=r.n(P),G=(r("0fae"),r("80f1")),z=r.n(G),D=r("2f62");n["default"].use(D["a"]);var q=new D["a"].Store({state:{speed:30},mutations:{changeSpeed:function(e,t){e.speed=t}},actions:{},modules:{}});n["default"].config.productionTip=!1,n["default"].use(A.a),n["default"].use(z.a,{prefix:"your_app_slug_",drivers:["session","local"]}),new n["default"]({store:q,render:function(e){return e(R)}}).$mount("#app")},"85ec":function(e,t,r){}});
//# sourceMappingURL=app.c5e96a38.js.map