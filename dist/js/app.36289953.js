(function(e){function t(t){for(var r,l,i=t[0],u=t[1],s=t[2],p=0,f=[];p<i.length;p++)l=i[p],Object.prototype.hasOwnProperty.call(o,l)&&o[l]&&f.push(o[l][0]),o[l]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);c&&c(t);while(f.length)f.shift()();return a.push.apply(a,s||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,i=1;i<n.length;i++){var u=n[i];0!==o[u]&&(r=!1)}r&&(a.splice(t--,1),e=l(l.s=n[0]))}return e}var r={},o={app:0},a=[];function l(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.m=e,l.c=r,l.d=function(e,t,n){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(l.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)l.d(n,r,function(t){return e[t]}.bind(null,r));return n},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var c=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var r=n("85ec"),o=n.n(r);o.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("GeneratorMidi")],1)},a=[],l=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[n("el-form-item",{attrs:{label:"Используемые длительности",prop:"beatConst"}},[n("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.beatConst,callback:function(t){e.$set(e.ruleForm,"beatConst",t)},expression:"ruleForm.beatConst"}})],1),n("el-form-item",{attrs:{label:"Диапазон нот",prop:"noteCount"}},[n("el-input-number",{attrs:{min:1,max:14},model:{value:e.ruleForm.noteCount,callback:function(t){e.$set(e.ruleForm,"noteCount",t)},expression:"ruleForm.noteCount"}})],1),n("el-form-item",{attrs:{label:"Предотвращать повторы",prop:"repeatControl"}},[n("el-switch",{attrs:{disabled:1===e.ruleForm.noteCount},model:{value:e.ruleForm.repeatControl,callback:function(t){e.$set(e.ruleForm,"repeatControl",t)},expression:"ruleForm.repeatControl"}})],1),n("el-form-item",{attrs:{label:"Количество файлов",prop:"filesCount"}},[n("el-input-number",{attrs:{min:1,max:50},model:{value:e.ruleForm.filesCount,callback:function(t){e.$set(e.ruleForm,"filesCount",t)},expression:"ruleForm.filesCount"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("Сгенерировать")]),n("el-button",{attrs:{type:"default"},on:{click:function(t){return e.saveConfig("ruleForm")}}},[e._v("Запомнить конфиг")])],1)],1),n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[n("el-form-item",{attrs:{label:"Скорость воспроизведения"}},[n("el-input-number",{attrs:{min:1,max:1024},on:{change:e.changeSpeed},model:{value:e.ruleForm.speed,callback:function(t){e.$set(e.ruleForm,"speed",t)},expression:"ruleForm.speed"}})],1)],1),e.tracks.length>0?n("el-button",{attrs:{type:"danger"},on:{click:e.downloadAll}},[e._v("Скачать все")]):e._e(),e._l(e.tracks,(function(t,r){return n("ul",{key:r},[n("Track",{attrs:{track:t,index:r,speed:e.ruleForm.speed}})],1)}))],2)},i=[],u=(n("4de4"),n("4160"),n("a9e3"),n("9129"),n("ac1f"),n("1276"),n("159b"),n("1f78")),s=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"],c=-10;function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(e===t)return 0;var r=e-.5+Math.random()*(t-e+1),o=Math.round(r);return n?o===c?p(e,t,n):(c=o,o):o}function f(e,t){var n=t.noteCount,r=t.repeatControl,o=128,a=0,l=[];while(a<o){var i=e[p(0,e.length-1)];a+i>o&&(i=o-a),l.push({duration:i,pitch:s[p(0,n-1,r)]}),a+=i}return l}function m(e){var t=e.noteCount,n=e.repeatControl,r=e.beatConst,o=new u.Track,a=[],l=f(r,{noteCount:t,repeatControl:n});l.forEach((function(e){a.push(new u.NoteEvent({pitch:e.pitch,duration:"T"+4*e.duration}))})),o.setTempo(30).addEvent(a,(function(e,t){return{sequential:!0}}));var i=new u.Writer(o);return i.dataUri()}var d=m,h=n("ec26");function b(e){return e[Math.floor(Math.random()*e.length)]}var v=b,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("li",{on:{allStop:e.stop}},[e._v(" "+e._s(e.name)+" "),n("el-button-group",[e.playing?e._e():n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.play}},[e._v("play")]),e.playing?n("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.stop}},[e._v("stop")]):e._e(),n("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-download"},on:{click:e.download}})],1)],1)},y=[],w=(n("b0c0"),n("96cf"),n("1da1")),$=n("3f0e"),C=n.n($),k=n("405e"),F=n.n(k),x={name:"Track",data:function(){return{playing:!1,name:this.name="track"+Object(h["a"])()+".mid"}},props:["track","speed","index"],methods:{play:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$root.$emit("all stop"),e.playing=!0,n=window.AudioContext||window.webkitAudioContext||!1,r=new n,o=e,F.a.instrument(r,"acoustic_grand_piano-mp3.js").then((function(e){var t=new C.a.Player((function(n){o.playing||t.stop(),"Note on"===n.name&&n.velocity>0&&e.play(n.noteName,r.currentTime,{gain:n.velocity/100,duration:1})}));t.loadDataUri(o.track),t.play(),t.setTempo(o.speed),o.$root.$on("all stop",(function(){t.stop()})),t.on("endOfFile",(function(){o.stop(),setTimeout((function(){o.$root.$emit("play",o.index+1)}),2e3)}))}));case 6:case"end":return t.stop()}}),t)})))()},stop:function(){this.playing=!1},download:function(){var e=this;return Object(w["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=document.createElement("a"),n.download=e.name,n.href=e.track,n.click();case 4:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this,t=this;this.$root.$on("all stop",(function(){t.stop()})),this.$root.$on("all download",(function(){t.stop(),e.download()})),t.$root.$on("name generate",(function(){e.name="track"+Object(h["a"])()+".mid"})),t.$root.$on("play",(function(n){n===t.index&&e.play()}))},destroyed:function(){this.stop()}},_=x,O=n("2877"),j=Object(O["a"])(_,g,y,!1,null,"384b44c4",null),S=j.exports;var T={name:"GeneratorMidi",components:{Track:S},computed:{speed:function(){return this.store.speed}},data:function(){return{ruleForm:{beatConst:"2 4 8",noteCount:14,repeatControl:!0,filesCount:2,speed:30},tracks:[],rules:{beatConst:[{required:!0,pattern:/^( *[0-9]* *)*$/g,message:"Допустимые длительности только числа, разделенные пробелом в одну строку",trigger:"blur"}]}}},methods:{downloadAll:function(){this.$root.$emit("all download")},changeSpeed:function(e){this.$root.$emit("all stop"),this.$store.commit("changeSpeed",e)},saveConfig:function(e){var t=this;console.log(1),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$root.$localStorage.set("config",t.ruleForm)}))},submitForm:function(e){var t=this;v([1]),this.$root.$emit("all stop"),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var n=[];t.ruleForm.beatConst.split(" ").forEach((function(e){n.push(parseInt(e))}));var r=Object.assign({},t.ruleForm);if(r.beatConst=n.filter((function(e){return!Number.isNaN(e)})),1===r.filesCount){var o=d(r);t.tracks=[o]}else{t.tracks=[];for(var a=0;a<r.filesCount;a++){var l=d(r);t.tracks.push(l)}}t.$root.$emit("name generate",(function(){}))}))}},mounted:function(){null!==this.$root.$localStorage.get("config")&&(this.ruleForm=this.$root.$localStorage.get("config"))}},M=T,E=Object(O["a"])(M,l,i,!1,null,"6aebb26d",null),P=E.exports,A={name:"App",components:{GeneratorMidi:P}},N=A,G=(n("034f"),Object(O["a"])(N,o,a,!1,null,null,null)),R=G.exports,z=n("5c96"),D=n.n(z),q=(n("0fae"),n("80f1")),B=n.n(q),J=n("2f62");r["default"].use(J["a"]);var U=new J["a"].Store({state:{speed:30},mutations:{changeSpeed:function(e,t){e.speed=t}},actions:{},modules:{}});r["default"].config.productionTip=!1,r["default"].use(D.a),r["default"].use(B.a,{prefix:"your_app_slug_",drivers:["session","local"]}),new r["default"]({store:U,render:function(e){return e(R)}}).$mount("#app")},"85ec":function(e,t,n){}});
//# sourceMappingURL=app.36289953.js.map