(function(e){function t(t){for(var o,l,i=t[0],u=t[1],s=t[2],m=0,p=[];m<i.length;m++)l=i[m],Object.prototype.hasOwnProperty.call(n,l)&&n[l]&&p.push(n[l][0]),n[l]=0;for(o in u)Object.prototype.hasOwnProperty.call(u,o)&&(e[o]=u[o]);c&&c(t);while(p.length)p.shift()();return a.push.apply(a,s||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],o=!0,i=1;i<r.length;i++){var u=r[i];0!==n[u]&&(o=!1)}o&&(a.splice(t--,1),e=l(l.s=r[0]))}return e}var o={},n={app:0},a=[];function l(t){if(o[t])return o[t].exports;var r=o[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,l),r.l=!0,r.exports}l.m=e,l.c=o,l.d=function(e,t,r){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(l.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)l.d(r,o,function(t){return e[t]}.bind(null,o));return r},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=t,i=i.slice();for(var s=0;s<i.length;s++)t(i[s]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";var o=r("85ec"),n=r.n(o);n.a},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var o=r("2b0e"),n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("GeneratorMidi")],1)},a=[],l=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[r("el-form-item",{attrs:{label:"Входной ритм",prop:"beat"}},[r("el-input",{attrs:{type:"textarea",disabled:e.ruleForm.isRandomBeat},model:{value:e.ruleForm.beat,callback:function(t){e.$set(e.ruleForm,"beat",t)},expression:"ruleForm.beat"}}),r("el-button",{staticStyle:{"margin-top":"25px"},attrs:{type:"default",disabled:e.ruleForm.isRandomBeat},on:{click:function(t){return e.randomBeat()}}},[e._v("Сгенерировать рандомный ритм")])],1),r("el-form-item",{attrs:{label:"Используемые длительности",prop:"beatConst"}},[r("el-input",{attrs:{type:"textarea"},model:{value:e.ruleForm.beatConst,callback:function(t){e.$set(e.ruleForm,"beatConst",t)},expression:"ruleForm.beatConst"}})],1),r("el-form-item",{attrs:{label:"Рандомный ритм для фрагментов",prop:"repeatControl"}},[r("el-switch",{model:{value:e.ruleForm.isRandomBeat,callback:function(t){e.$set(e.ruleForm,"isRandomBeat",t)},expression:"ruleForm.isRandomBeat"}})],1),r("el-form-item",{attrs:{label:"Один бит на файл",prop:"oneBeatFile"}},[r("el-switch",{model:{value:e.ruleForm.oneBeatFile,callback:function(t){e.$set(e.ruleForm,"oneBeatFile",t)},expression:"ruleForm.oneBeatFile"}})],1),r("el-form-item",{attrs:{label:"Диапазон нот",prop:"noteCount"}},[r("el-input-number",{attrs:{min:1,max:14},model:{value:e.ruleForm.noteCount,callback:function(t){e.$set(e.ruleForm,"noteCount",t)},expression:"ruleForm.noteCount"}})],1),r("el-form-item",{attrs:{label:"Длинна ритма",prop:"beatLength"}},[r("el-input-number",{attrs:{min:1,max:128},model:{value:e.ruleForm.beatLength,callback:function(t){e.$set(e.ruleForm,"beatLength",t)},expression:"ruleForm.beatLength"}}),e._v(" / 32 такта ")],1),r("el-form-item",{attrs:{label:"Предотвращать повторы",prop:"repeatControl"}},[r("el-switch",{attrs:{disabled:1===e.ruleForm.noteCount},model:{value:e.ruleForm.repeatControl,callback:function(t){e.$set(e.ruleForm,"repeatControl",t)},expression:"ruleForm.repeatControl"}})],1),r("el-form-item",{attrs:{label:"Короткие ноты",prop:"shortNote"}},[r("el-switch",{model:{value:e.ruleForm.shortNote,callback:function(t){e.$set(e.ruleForm,"shortNote",t)},expression:"ruleForm.shortNote"}})],1),r("el-form-item",{attrs:{label:"Пауза после ритма",prop:"restEnable"}},[r("el-switch",{model:{value:e.ruleForm.restEnable,callback:function(t){e.$set(e.ruleForm,"restEnable",t)},expression:"ruleForm.restEnable"}})],1),r("el-form-item",{attrs:{label:"Длина трека",prop:"trackLength"}},[r("el-input-number",{attrs:{min:1,max:1e4},model:{value:e.ruleForm.trackLength,callback:function(t){e.$set(e.ruleForm,"trackLength",t)},expression:"ruleForm.trackLength"}}),r("el-select",{staticStyle:{"margin-left":"20px"},attrs:{placeholder:"Select"},model:{value:e.ruleForm.typeLength,callback:function(t){e.$set(e.ruleForm,"typeLength",t)},expression:"ruleForm.typeLength"}},e._l(e.options,(function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),r("el-form-item",{attrs:{label:"Количество файлов",prop:"filesCount"}},[r("el-input-number",{attrs:{min:1,max:50},model:{value:e.ruleForm.filesCount,callback:function(t){e.$set(e.ruleForm,"filesCount",t)},expression:"ruleForm.filesCount"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("Сгенерировать")]),r("el-button",{attrs:{type:"default"},on:{click:function(t){return e.saveConfig("ruleForm")}}},[e._v("Запомнить конфиг")])],1)],1),r("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"250px"}},[r("el-form-item",{attrs:{label:"Скорость воспроизведения"}},[r("el-input-number",{attrs:{min:1,max:1024},on:{change:e.changeSpeed},model:{value:e.ruleForm.speed,callback:function(t){e.$set(e.ruleForm,"speed",t)},expression:"ruleForm.speed"}})],1)],1),r("el-button",{attrs:{type:"danger"},on:{click:e.downloadAll}},[e._v("Скачать все")]),e._l(e.tracks,(function(t,o){return r("ul",{key:o},[r("Track",{attrs:{track:t,speed:e.ruleForm.speed}})],1)}))],2)},i=[],u=(r("4de4"),r("4160"),r("a9e3"),r("9129"),r("ac1f"),r("1276"),r("159b"),r("1f78")),s=-10;function c(e,t,r){if(e===t)return 0;var o=e-.5+Math.random()*(t-e+1),n=Math.round(o);return r?n===s?c(e,t,r):(s=n,n):n}function m(e,t){function r(e,t){var r=e-.5+Math.random()*(t-e+1);return Math.round(r)}e*=4;var o=0,n=[];while(o<=e-8){var a=t[r(0,t.length-1)];n.push(a),o+=a}return n}var p=["C4","D4","E4","F4","G4","A4","B4","C5","D5","E5","F5","G5","A5","B5"];function f(e,t){var r=e.beat,o=e.noteCount,n=e.repeatControl,a=e.trackLength,l=e.typeLength,i=e.restEnable,s=e.isRandomBeat,f=e.shortNote,d=e.beatLength,b=e.oneBeatFile,h=e.beatConst,v=new u.Track,g=[];"sec"===l&&(a*=32);var F=0;r=m(d,h);for(var y=function(e){s&&!b&&(r=m(d,h)),r.forEach((function(t){e<a&&(g.push(new u.NoteEvent({pitch:[p[c(0,o-1,n)]],duration:!0===f?"T4":"T"+8*t,startTick:F})),F+=8*t),"note"===l?e++:"sec"===l&&(e+=t)})),"beat"===l&&e++,"sec"===l&&i&&(e+=16),i&&(F+=128),k=e},k=0;k<a;)y(k);v.setTempo(30).addEvent(g,(function(e,t){return{sequential:!0}}));var $=new u.Writer(v);return t?$.buildFile():$.dataUri()}var d=f,b=r("ec26"),h=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{on:{allStop:e.stop}},[e._v(" "+e._s(e.name)+" "),r("el-button-group",[e.playing?e._e():r("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.play}},[e._v("play")]),e.playing?r("el-button",{attrs:{size:"small",type:"danger"},on:{click:e.stop}},[e._v("stop")]):e._e(),r("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-download"},on:{click:e.download}})],1)],1)},v=[],g=(r("b0c0"),r("96cf"),r("1da1")),F=r("3f0e"),y=r.n(F),k=r("405e"),$=r.n(k),w={name:"Track",data:function(){return{playing:!1,name:this.name="track"+Object(b["a"])()+".mid"}},props:["track","speed"],methods:{play:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r,o,n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$root.$emit("all stop"),e.playing=!0,r=window.AudioContext||window.webkitAudioContext||!1,o=new r,n=e,t.next=7,setTimeout((function(){$.a.instrument(o,"https://raw.githubusercontent.com/gleitz/midi-js-soundfonts/gh-pages/MusyngKite/acoustic_grand_piano-mp3.js").then((function(e){var t=new y.a.Player((function(r){n.playing||t.stop(),"Note on"===r.name&&r.velocity>0&&(e.play(r.noteName,o.currentTime,{gain:r.velocity/100,duration:1}),console.log(r))}));t.loadDataUri(n.track),t.play(),t.setTempo(n.speed),n.$root.$on("all stop",(function(){t.stop()})),t.on("endOfFile",(function(){n.stop()}))}))}),1e3);case 7:case"end":return t.stop()}}),t)})))()},stop:function(){this.playing=!1},download:function(){var e=this;return Object(g["a"])(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=document.createElement("a"),r.download=e.name,r.href=e.track,r.click();case 4:case"end":return t.stop()}}),t)})))()}},mounted:function(){var e=this,t=this;this.$root.$on("all stop",(function(){t.stop()})),this.$root.$on("all download",(function(){t.stop(),e.download()})),t.$root.$on("name generate",(function(){e.name="track"+Object(b["a"])()+".mid"}))},updated:function(){},destroyed:function(){this.stop()}},x=w,C=r("2877"),_=Object(C["a"])(x,h,v,!1,null,"3f9e358a",null),O=_.exports;var j={name:"GeneratorMidi",components:{Track:O},computed:{speed:function(){return this.store.speed}},data:function(){return{ruleForm:{beat:"2 4 8",noteCount:14,beatConst:"2 4 8",repeatControl:!0,restEnable:!0,beatLength:32,shortNote:!0,trackLength:5,typeLength:"note",isRandomBeat:!1,filesCount:2,speed:30,oneBeatFile:!1},tracks:[],rules:{beat:[{required:!0,pattern:/^( *[0-9]* *)*$/g,message:"Ритм должен содержать только числа, разделенные пробелом в одну строку",trigger:"blur"}],beatConst:[{required:!0,pattern:/^( *[0-9]* *)*$/g,message:"Допустимые длительности только числа, разделенные пробелом в одну строку",trigger:"blur"}]},options:[{value:"sec",label:"Секунд"},{value:"note",label:"Нот"},{value:"beat",label:"Ритмов"}],options1:[{value:"2",label:"2"},{value:"4",label:"4"},{value:"8",label:"8"}]}},methods:{downloadAll:function(){this.$root.$emit("all download")},changeSpeed:function(e){this.$root.$emit("all stop"),this.$store.commit("changeSpeed",e)},randomBeat:function(){function e(e,t){var r=e-.5+Math.random()*(t-e+1);return Math.round(r)}var t=[2,4,8],r=0;this.ruleForm.beat="";while(r<64){var o=t[e(0,2)];if(this.ruleForm.beat=this.ruleForm.beat+o+" ",r+=o,e(0,20)<10&&r>16)break}},saveConfig:function(e){var t=this;console.log(1),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$root.$localStorage.set("config",t.ruleForm)}))},submitForm:function(e){var t=this;this.$root.$emit("all stop"),this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;var r=[];t.ruleForm.beat.split(" ").forEach((function(e){r.push(parseInt(e))}));var o=[];t.ruleForm.beatConst.split(" ").forEach((function(e){o.push(parseInt(e))}));var n=Object.assign({},t.ruleForm);if(n.beat=r.filter((function(e){return!Number.isNaN(e)})),n.beatConst=o.filter((function(e){return!Number.isNaN(e)})),1===n.filesCount){var a=d(n,!1);t.tracks=[a]}else{t.tracks=[];for(var l=0;l<n.filesCount;l++){var i=d(n,!1);t.tracks.push(i)}}t.$root.$emit("name generate",(function(){}))}))},resetForm:function(e){this.$refs[e].resetFields()}},mounted:function(){console.log(this.$root.$localStorage.get("config")),null!==this.$root.$localStorage.get("config")&&(this.ruleForm=this.$root.$localStorage.get("config"))}},S=j,B=Object(C["a"])(S,l,i,!1,null,"3077d39e",null),E=B.exports,L={name:"App",components:{GeneratorMidi:E}},N=L,M=(r("034f"),Object(C["a"])(N,n,a,!1,null,null,null)),T=M.exports,R=r("5c96"),P=r.n(R),A=(r("0fae"),r("80f1")),G=r.n(A),z=r("2f62");o["default"].use(z["a"]);var q=new z["a"].Store({state:{speed:30},mutations:{changeSpeed:function(e,t){e.speed=t}},actions:{},modules:{}});o["default"].config.productionTip=!1,o["default"].use(P.a),o["default"].use(G.a,{prefix:"your_app_slug_",drivers:["session","local"]}),new o["default"]({store:q,render:function(e){return e(T)}}).$mount("#app")},"85ec":function(e,t,r){}});
//# sourceMappingURL=app.32446850.js.map