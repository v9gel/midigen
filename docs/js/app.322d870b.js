(function(e){function t(t){for(var o,r,i=t[0],s=t[1],u=t[2],d=0,p=[];d<i.length;d++)r=i[d],Object.prototype.hasOwnProperty.call(a,r)&&a[r]&&p.push(a[r][0]),a[r]=0;for(o in s)Object.prototype.hasOwnProperty.call(s,o)&&(e[o]=s[o]);c&&c(t);while(p.length)p.shift()();return l.push.apply(l,u||[]),n()}function n(){for(var e,t=0;t<l.length;t++){for(var n=l[t],o=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(o=!1)}o&&(l.splice(t--,1),e=r(r.s=n[0]))}return e}var o={},a={app:0},l=[];function r(t){if(o[t])return o[t].exports;var n=o[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=o,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var u=0;u<i.length;u++)t(i[u]);var c=s;l.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"034f":function(e,t,n){"use strict";var o=n("85ec"),a=n.n(o);a.a},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("GeneratorMidi")],1)},l=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button-group",[n("RecordBeat"),n("GenerateBeat")],1),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tracks,"row-class-name":e.tableRowClassName}},[n("el-table-column",{attrs:{label:"Название",width:"250"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",{staticStyle:{"margin-left":"10px"}},[e._v(e._s(t.row.name)+" ")])]}}])}),n("el-table-column",{attrs:{label:"Бит"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-popover",{attrs:{trigger:"hover",placement:"top"}},[n("p",[e._v("Длительности: "+e._s(t.row.beat.map((function(e){return e.duration}))))]),n("p",[e._v("Звуковысоты: "+e._s(t.row.beat.map((function(e){return e.pitch}))))]),n("div",{staticClass:"name-wrapper",attrs:{slot:"reference"},slot:"reference"},[n("el-tag",{attrs:{size:"medium"}},[e._v(e._s(t.row.beat.map((function(e){return e.duration}))))])],1)])]}}])}),n("el-table-column",{staticStyle:{width:"180px"},attrs:{label:"Действия"},scopedSlots:e._u([{key:"header",fn:function(t){return[e._v(" BPM "),n("el-input-number",{attrs:{min:1,max:1024,size:"mini","controls-position":"right"},on:{change:e.changeSpeed},model:{value:e.ruleForm.speed,callback:function(t){e.$set(e.ruleForm,"speed",t)},expression:"ruleForm.speed"}})]}},{key:"default",fn:function(t){return[t.$index!==e.played?n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handlePlay(t.$index)}}},[e._v("Play")]):e._e(),t.$index===e.played?n("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.handleStop()}}},[e._v("Stop")]):e._e(),n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleDownload(t.row.name,t.row.track)}}},[e._v("Download")]),n("el-button",{attrs:{size:"mini"},on:{click:function(n){return e.handleAdd(t.$index,t.row)}}},[e._v("Скопировать с рандомной звуковысотой")]),n("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(n){return e.handleDelete(t.$index,t.row)}}},[e._v("Delete")])]}}])})],1),n("Player",{attrs:{speed:e.ruleForm.speed}})],1)},i=[],s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div")},u=[],c=(n("b0c0"),n("96cf"),n("1da1")),d=n("405e"),p=n.n(d),f=n("3f0e"),m=n.n(f),b={name:"Player",data:function(){return{played:-1}},props:["speed"],computed:{tracks:function(){return this.$store.state.tracks}},mounted:function(){var e=this,t=this;this.$root.$on("all stop",(function(){t.stop()})),this.$root.$on("all download",(function(){t.stop(),e.download()})),this.$root.$on("play",(function(e){t.played=e,t.play()}))},destroyed:function(){this.stop()},stop:function(){this.played=-1,this.$root.$emit("all stop")},methods:{play:function(){var e=this;return Object(c["a"])(regeneratorRuntime.mark((function t(){var n,o,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$root.$emit("all stop"),n=window.AudioContext||window.webkitAudioContext||!1,o=new n,a=e,p.a.instrument(o,"acoustic_grand_piano-mp3.js").then((function(e){var t=new m.a.Player((function(n){-1===a.played&&t.stop(),"Note on"===n.name&&n.velocity>0&&e.play(n.noteName,o.currentTime,{gain:n.velocity/100,duration:1})}));t.loadDataUri(a.tracks[a.played].track),t.play(),t.setTempo(a.speed),a.$root.$on("all stop",(function(){t.stop()})),t.on("endOfFile",(function(){a.$root.$emit("all stop"),setTimeout((function(){a.$root.$emit("all stop"),a.played+1>a.tracks.length?a.$root.$emit("all stop"):a.$root.$emit("play",a.played+1)}),2e3)}))}));case 5:case"end":return t.stop()}}),t)})))()}}},h=b,v=n("2877"),w=Object(v["a"])(h,s,u,!1,null,"67f6669b",null),$=w.exports,g=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("Записать новый ритм")]),n("el-dialog",{attrs:{title:"Запись нового ритма",visible:e.dialogVisible,width:"70%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",{staticClass:"hello"},[e.start?e._e():n("p",[e._v(" Для начала записи начните настукивать ритм c помощью клавиши Пробел ")]),e.start?n("p",[e._v(" Идет запись... ")]):e._e(),n("p",[e._v("Скорость 30BPM")]),n("p",[e._v("Ритм: "+e._s(e.beat.map((function(e){return Math.round(e/65.5)}))))]),n("el-button",{on:{click:e.reset}},[e._v("Сбросить")]),n("el-button",{on:{click:e.end}},[e._v("Стоп")]),n("br")],1)])],1)},y=[],C=(n("d81d"),{name:"RecordBeat",data:function(){return{dialogVisible:!1,i:1,beat:[],start:!1,stop:!1,startTime:null,lastNote:null}},created:function(){var e=this;window.addEventListener("keydown",(function(t){"Space"==t.code&&e.down()})),window.addEventListener("keyup",(function(t){"Space"==t.code&&e.up()}))},methods:{handleClose:function(e){this.$confirm("Подтвердите закрытие диалога").then((function(t){e()})).catch((function(e){}))},reset:function(){this.i=1,this.beat=[],this.start=!1,this.stop=!1,this.startTime=null,this.lastNote=null},end:function(){var e=this.beat.map((function(e){return Math.round(e/65.5)}));e.pop(),this.$store.commit("generateBeat",{flagRecord:!0,beat:e}),this.reset()},down:function(){this.start||(this.start=!0,this.startTime=Date.now(),this.lastNote=this.startTime)},up:function(){var e=Date.now();this.beat.push(e-this.lastNote),this.lastNote=e,this.i++}}}),k=C,_=Object(v["a"])(k,g,y,!1,null,"e2392b7c",null),F=_.exports,x=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("el-button",{attrs:{type:"text"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("Сгенерировать новый ритм")]),n("el-dialog",{attrs:{title:"Запись нового ритма",visible:e.dialogVisible,width:"70%","before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"205px"}},[n("el-form-item",{attrs:{label:"Используемые длительности",prop:"beatConst"}},[n("el-select",{attrs:{"allow-create":"",filterable:"","default-first-option":"",multiple:"",placeholder:"Select"},model:{value:e.ruleForm.beatConst,callback:function(t){e.$set(e.ruleForm,"beatConst",t)},expression:"ruleForm.beatConst"}},e._l(e.options1,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"Используемые ноты",prop:"noteConst"}},[n("el-select",{attrs:{multiple:"","default-first-option":"",placeholder:"Select"},model:{value:e.ruleForm.noteConst,callback:function(t){e.$set(e.ruleForm,"noteConst",t)},expression:"ruleForm.noteConst"}},e._l(e.options2,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),n("el-form-item",{attrs:{label:"Предотвращать повторы",prop:"repeatControl"}},[n("el-switch",{attrs:{disabled:1===e.ruleForm.noteCount},model:{value:e.ruleForm.repeatControl,callback:function(t){e.$set(e.ruleForm,"repeatControl",t)},expression:"ruleForm.repeatControl"}})],1),n("el-form-item",{attrs:{label:"Количество файлов",prop:"filesCount"}},[n("el-input-number",{attrs:{min:1,max:50},model:{value:e.ruleForm.filesCount,callback:function(t){e.$set(e.ruleForm,"filesCount",t)},expression:"ruleForm.filesCount"}})],1),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("Сгенерировать")]),n("el-button",{attrs:{type:"default"},on:{click:function(t){return e.saveConfig("ruleForm")}}},[e._v("Запомнить конфиг")])],1)],1),n("el-form",{ref:"ruleForm",attrs:{model:e.ruleForm,"label-position":"left",rules:e.rules,"label-width":"205px"}})],1)],1)},S=[],E={name:"GenerateBeat",data:function(){return{dialogVisible:!1,ruleForm:{beatConst:["2","4"],noteConst:["C4","D4","E4"],repeatControl:!0,filesCount:2,speed:30},options1:[{value:"2",label:"2"},{value:"4",label:"4"},{value:"8",label:"8"}],options2:[{value:"C4",label:"C4"},{value:"D4",label:"D4"},{value:"E4",label:"E4"},{value:"F4",label:"F4"},{value:"G4",label:"G4"},{value:"A4",label:"A4"},{value:"B4",label:"B4"},{value:"C5",label:"C5"},{value:"D5",label:"D5"},{value:"E5",label:"E5"},{value:"F5",label:"F5"},{value:"G5",label:"G5"},{value:"A5",label:"A5"},{value:"B5",label:"B5"}],rules:{}}},methods:{handleClose:function(e){this.$confirm("Подтвердите закрытие диалога").then((function(t){e()})).catch((function(e){}))},saveConfig:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return console.log("error submit!!"),!1;t.$root.$localStorage.set("config",t.ruleForm)}))},submitForm:function(e){this.$root.$emit("all stop"),this.$store.commit("generateBeat",Object.assign({},this.ruleForm))}}},D=E,O=Object(v["a"])(D,x,S,!1,null,"f98225b8",null),j=O.exports,B={name:"GeneratorMidi",components:{GenerateBeat:j,RecordBeat:F,Player:$},computed:{speed:function(){return this.store.speed},tracks:function(){return this.$store.state.tracks}},data:function(){return{ruleForm:{beatConst:["2","4"],noteConst:["C4","D4","E4"],repeatControl:!0,filesCount:2,speed:30},options1:[{value:"2",label:"2"},{value:"4",label:"4"},{value:"8",label:"8"}],options2:[{value:"C4",label:"C4"},{value:"D4",label:"D4"},{value:"E4",label:"E4"},{value:"F4",label:"F4"},{value:"G4",label:"G4"},{value:"A4",label:"A4"},{value:"B4",label:"B4"},{value:"C5",label:"C5"},{value:"D5",label:"D5"},{value:"E5",label:"E5"},{value:"F5",label:"F5"},{value:"G5",label:"G5"},{value:"A5",label:"A5"},{value:"B5",label:"B5"}],rules:{},played:-1}},methods:{downloadAll:function(){this.$root.$emit("all download")},handlePlay:function(e){this.$root.$emit("play",e)},handleStop:function(){this.$root.$emit("all stop")},tableRowClassName:function(e){e.row;var t=e.rowIndex;return t===this.played?"played-row":""},handleDownload:function(e,t){var n=document.createElement("a");n.download=e,n.href=t,n.click()},handleDelete:function(e){this.$store.commit("delete",e)},handleAdd:function(e,t){this.$store.commit("add",{index:e,ruleForm:this.ruleForm})},changeSpeed:function(e){this.$root.$emit("all stop"),this.$store.commit("changeSpeed",e)}},mounted:function(){var e=this;null!==this.$root.$localStorage.get("config")&&(this.ruleForm=this.$root.$localStorage.get("config")),null!==this.$root.$localStorage.get("tracks")&&this.$store.commit("start",this.$root.$localStorage.get("tracks")),this.$root.$on("play",(function(t){e.played=t,e.play()})),this.$root.$on("all stop",(function(t){e.played=-1}))}},T=B,P=(n("f81b"),Object(v["a"])(T,r,i,!1,null,null,null)),A=P.exports,G={name:"App",components:{GeneratorMidi:A}},M=G,N=(n("034f"),Object(v["a"])(M,a,l,!1,null,null,null)),U=N.exports,R=n("5c96"),V=n.n(R),z=(n("0fae"),n("80f1")),I=n.n(z),q=(n("4de4"),n("4160"),n("a434"),n("159b"),n("2f62"));function W(e){return e[Math.floor(Math.random()*e.length)]}function J(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Object.assign([],e).map((function(e){return parseInt(e)})),a=Object.assign([],t),l=128,r=0,i=[],s="";while(r<l){var u=W(o);r+u>l&&(u=l-r);var c=W(a);n&&c===s&&a.length>1&&(c=W(a.filter((function(e){return e!=s})))),s=c,i.push({duration:u,pitch:c}),r+=u}return i}var L=n("0b97"),H=n("1f78"),K=n.n(H),Q=new L["a"];o["default"].use(q["a"]);var X=new q["a"].Store({state:{speed:30,tracks:[]},mutations:{start:function(e,t){e.tracks=t},changeSpeed:function(e,t){e.speed=t},delete:function(e,t){e.tracks.splice(t,1),o["default"].$localStorage.set("tracks",e.tracks)},add:function(e,t){for(var n=t.index,a=t.ruleForm,l=function(t){var l=Object.assign({},e.tracks[n]),r=[],i=l.name.substr(0,12)+"_"+Q.randomUUID(6)+".mid",s=new K.a.Track,u=[],c="";a={beatConst:["2","4"],noteConst:["C4","D4","E4"],repeatControl:!0,filesCount:1,speed:30};for(var d=0;d<l.beat.length;d++){var p=W(a.noteConst);a.repeatControl&&p===c&&a.noteConst.length>1&&(p=W(a.noteConst.filter((function(e){return e!=c})))),r.push({pitch:p,duration:l.beat[d].duration}),c=p}console.log(l),r.forEach((function(e){u.push(new K.a.NoteEvent({pitch:e.pitch,duration:"T"+4*e.duration}))})),s.setTempo(30).addEvent(u,(function(e,t){return{sequential:!0}}));var f=new K.a.Writer(s);e.tracks.push({beat:r,name:i,track:f.dataUri()}),o["default"].$localStorage.set("tracks",e.tracks)},r=0;r<a.filesCount;r++)l(r)},generateBeat:function(e,t){if(t.flagRecord){var n=t.beat,a=[],l="track_"+Q.randomUUID(6)+".mid",r=new K.a.Track,i=[];n.forEach((function(e){i.push(new K.a.NoteEvent({pitch:"C4",duration:"T"+4*e})),a.push({pitch:"C4",duration:e})})),r.setTempo(30).addEvent(i,(function(e,t){return{sequential:!0}}));var s=new K.a.Writer(r);e.tracks.push({beat:a,name:l,track:s.dataUri()})}else for(var u=function(n){t.noteConst=["C4"];var o=J(t.beatConst,t.noteConst,t.repeatControl),a="track_"+Q.randomUUID(6)+".mid",l=new K.a.Track,r=[];o.forEach((function(e){r.push(new K.a.NoteEvent({pitch:e.pitch,duration:"T"+4*e.duration}))})),l.setTempo(30).addEvent(r,(function(e,t){return{sequential:!0}}));var i=new K.a.Writer(l);e.tracks.push({beat:o,name:a,track:i.dataUri()})},c=0;c<t.filesCount;c++)u(c);o["default"].$localStorage.set("tracks",e.tracks)}},actions:{},modules:{}}),Y=n("dccd"),Z=n.n(Y);o["default"].config.productionTip=!1,o["default"].use(V.a,{locale:Z.a}),o["default"].use(I.a,{prefix:"your_app_slug_",drivers:["session","local"]}),new o["default"]({store:X,render:function(e){return e(U)}}).$mount("#app")},"85ec":function(e,t,n){},de5f:function(e,t,n){},f81b:function(e,t,n){"use strict";var o=n("de5f"),a=n.n(o);a.a}});
//# sourceMappingURL=app.322d870b.js.map